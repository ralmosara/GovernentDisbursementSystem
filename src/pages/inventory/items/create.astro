---
import MainLayout from '../../../layouts/MainLayout.astro';

const user = Astro.locals.user;

if (!user) {
  return Astro.redirect('/login');
}
---

<MainLayout title="Add Inventory Item">
  <div class="container mx-auto px-4 py-6">
    <!-- Breadcrumb -->
    <nav class="mb-4">
      <ol class="flex items-center space-x-2 text-sm text-gray-500">
        <li>
          <a href="/inventory/items" class="hover:text-gray-700">Inventory Items</a>
        </li>
        <li><i class="pi pi-angle-right"></i></li>
        <li class="text-gray-900">Add Item</li>
      </ol>
    </nav>

    <!-- Page Header -->
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-gray-900">Add Inventory Item</h1>
      <p class="mt-1 text-sm text-gray-600">
        Create a new stock item in the inventory system
      </p>
    </div>

    <!-- Form Container -->
    <div class="bg-white rounded-lg shadow border border-gray-200 p-6">
      <div id="item-form"></div>
    </div>
  </div>

  <script>
    import InventoryItemForm from '../../../components/forms/inventory/InventoryItemForm.vue';
    import { createApp } from 'vue';

    const app = createApp(InventoryItemForm, {
      onSubmit: async (formData) => {
        try {
          const response = await fetch('/api/inventory/items', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
          });

          if (response.ok) {
            const result = await response.json();
            window.location.href = `/inventory/items/${result.id}`;
          } else {
            const error = await response.json();
            alert(error.error || 'Failed to create inventory item');
          }
        } catch (error) {
          console.error('Error creating inventory item:', error);
          alert('Failed to create inventory item. Please try again.');
        }
      },
      onCancel: () => {
        window.history.back();
      },
    });

    app.mount('#item-form');
  </script>
</MainLayout>
